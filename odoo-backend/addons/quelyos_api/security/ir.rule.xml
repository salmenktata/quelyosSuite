<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!-- ========================================================================== -->
        <!-- RÈGLES D'ISOLATION MULTI-TENANT                                           -->
        <!-- ========================================================================== -->
        <!-- Ces règles renforcent l'isolation des données au niveau base de données  -->
        <!-- Elles complètent les filtres API en empêchant l'accès direct via Odoo UI -->
        <!-- ========================================================================== -->

        <!-- ========================================== -->
        <!-- Isolation par company_id (Natif Odoo)     -->
        <!-- ========================================== -->

        <!-- Produits : Isolation par company -->
        <record id="product_template_company_rule" model="ir.rule">
            <field name="name">Product Template: multi-company</field>
            <field name="model_id" ref="product.model_product_template"/>
            <field name="domain_force">[('company_id', 'in', company_ids + [False])]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="product_product_company_rule" model="ir.rule">
            <field name="name">Product Variant: multi-company</field>
            <field name="model_id" ref="product.model_product_product"/>
            <field name="domain_force">[('company_id', 'in', company_ids + [False])]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- Commandes : Isolation par company -->
        <record id="sale_order_company_rule" model="ir.rule">
            <field name="name">Sale Order: multi-company</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- Contacts : Isolation par company -->
        <record id="res_partner_company_rule" model="ir.rule">
            <field name="name">Partner: multi-company</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">[('company_id', 'in', company_ids + [False])]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- Isolation par tenant_id (Custom Quelyos)  -->
        <!-- ========================================== -->
        <!-- DÉSACTIVÉ TEMPORAIREMENT : Les modèles custom Quelyos seront ajoutés dans une prochaine version -->

        <!-- TODO: Réactiver après création des modèles quelyos_product_review, quelyos_wishlist, quelyos_loyalty_program -->
        <!--
        <record id="product_review_tenant_rule" model="ir.rule">
            <field name="name">Product Review: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_product_review"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="wishlist_tenant_rule" model="ir.rule">
            <field name="name">Wishlist: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_wishlist"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="loyalty_program_tenant_rule" model="ir.rule">
            <field name="name">Loyalty Program: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_loyalty_program"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="loyalty_customer_tenant_rule" model="ir.rule">
            <field name="name">Loyalty Customer: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_loyalty_customer"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>
        -->

        <!-- TODO: Réactiver après création des modèles custom Quelyos -->
        <!--
        <record id="coupon_tenant_rule" model="ir.rule">
            <field name="name">Coupon: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_coupon"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="abandoned_cart_tenant_rule" model="ir.rule">
            <field name="name">Abandoned Cart: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_abandoned_cart"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="email_campaign_tenant_rule" model="ir.rule">
            <field name="name">Email Campaign: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_email_campaign"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="sms_campaign_tenant_rule" model="ir.rule">
            <field name="name">SMS Campaign: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_sms_campaign"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="menu_navigation_tenant_rule" model="ir.rule">
            <field name="name">Menu Navigation: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_menu_navigation"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="page_cms_tenant_rule" model="ir.rule">
            <field name="name">Page CMS: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_page"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>
        -->

        <!-- TODO: Réactiver après création de tous les modèles custom Quelyos -->
        <!--
        <record id="theme_tenant_rule" model="ir.rule">
            <field name="name">Theme: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_theme"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="hero_slide_tenant_rule" model="ir.rule">
            <field name="name">Hero Slide: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_hero_slide"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="promo_banner_tenant_rule" model="ir.rule">
            <field name="name">Promo Banner: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_promo_banner"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="stock_alert_tenant_rule" model="ir.rule">
            <field name="name">Stock Alert: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_stock_alert"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>
        -->

        <!-- ========================================== -->
        <!-- Isolation Tenant Model (lui-même)         -->
        <!-- ========================================== -->

        <!-- Les utilisateurs ne peuvent voir QUE leur propre tenant -->
        <!-- Exception: Super admins (base.group_system) peuvent voir tous les tenants -->
        <record id="tenant_own_company_rule" model="ir.rule">
            <field name="name">Tenant: own company only</field>
            <field name="model_id" ref="model_quelyos_tenant"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- Super admins peuvent voir TOUS les tenants -->
        <record id="tenant_superadmin_rule" model="ir.rule">
            <field name="name">Tenant: super admin full access</field>
            <field name="model_id" ref="model_quelyos_tenant"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        </record>

        <!-- ========================================== -->
        <!-- Isolation Subscription                    -->
        <!-- ========================================== -->

        <record id="subscription_company_rule" model="ir.rule">
            <field name="name">Subscription: multi-company</field>
            <field name="model_id" ref="model_quelyos_subscription"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- Super admins peuvent voir TOUTES les subscriptions -->
        <record id="subscription_superadmin_rule" model="ir.rule">
            <field name="name">Subscription: super admin full access</field>
            <field name="model_id" ref="model_quelyos_subscription"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        </record>

    </data>
</odoo>
