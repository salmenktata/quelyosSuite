<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!-- ========================================================================== -->
        <!-- RÈGLES D'ISOLATION MULTI-TENANT                                           -->
        <!-- ========================================================================== -->
        <!-- Ces règles renforcent l'isolation des données au niveau base de données  -->
        <!-- Elles complètent les filtres API en empêchant l'accès direct via Odoo UI -->
        <!-- ========================================================================== -->

        <!-- ========================================== -->
        <!-- Isolation par company_id (Natif Odoo)     -->
        <!-- ========================================== -->

        <!-- Produits : Isolation par company -->
        <record id="product_template_company_rule" model="ir.rule">
            <field name="name">Product Template: multi-company</field>
            <field name="model_id" ref="product.model_product_template"/>
            <field name="domain_force">[('company_id', 'in', company_ids + [False])]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="product_product_company_rule" model="ir.rule">
            <field name="name">Product Variant: multi-company</field>
            <field name="model_id" ref="product.model_product_product"/>
            <field name="domain_force">[('company_id', 'in', company_ids + [False])]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- Commandes : Isolation par company -->
        <record id="sale_order_company_rule" model="ir.rule">
            <field name="name">Sale Order: multi-company</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- Contacts : Isolation par company -->
        <record id="res_partner_company_rule" model="ir.rule">
            <field name="name">Partner: multi-company</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">[('company_id', 'in', company_ids + [False])]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- Isolation Tenant Model (lui-même)         -->
        <!-- ========================================== -->

        <!-- Les utilisateurs ne peuvent voir QUE leur propre tenant -->
        <!-- Exception: Super admins (base.group_system) peuvent voir tous les tenants -->
        <record id="tenant_own_company_rule" model="ir.rule">
            <field name="name">Tenant: own company only</field>
            <field name="model_id" ref="model_quelyos_tenant"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- Super admins peuvent voir TOUS les tenants -->
        <record id="tenant_superadmin_rule" model="ir.rule">
            <field name="name">Tenant: super admin full access</field>
            <field name="model_id" ref="model_quelyos_tenant"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        </record>

        <!-- ========================================== -->
        <!-- Isolation Subscription                    -->
        <!-- ========================================== -->

        <record id="subscription_company_rule" model="ir.rule">
            <field name="name">Subscription: multi-company</field>
            <field name="model_id" ref="model_quelyos_subscription"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- Super admins peuvent voir TOUTES les subscriptions -->
        <record id="subscription_superadmin_rule" model="ir.rule">
            <field name="name">Subscription: super admin full access</field>
            <field name="model_id" ref="model_quelyos_subscription"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        </record>

        <!-- ========================================== -->
        <!-- STORE / E-COMMERCE - Isolation par tenant -->
        <!-- ========================================== -->

        <record id="product_review_tenant_rule" model="ir.rule">
            <field name="name">Product Review: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_product_review"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="collection_tenant_rule" model="ir.rule">
            <field name="name">Collection: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_collection"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="bundle_tenant_rule" model="ir.rule">
            <field name="name">Bundle: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_bundle"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="flash_sale_tenant_rule" model="ir.rule">
            <field name="name">Flash Sale: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_flash_sale"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="faq_category_tenant_rule" model="ir.rule">
            <field name="name">FAQ Category: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_faq_category"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="testimonial_tenant_rule" model="ir.rule">
            <field name="name">Testimonial: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_testimonial"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- LOYALTY - Isolation par tenant            -->
        <!-- ========================================== -->

        <record id="loyalty_program_tenant_rule" model="ir.rule">
            <field name="name">Loyalty Program: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_loyalty_program"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="loyalty_level_tenant_rule" model="ir.rule">
            <field name="name">Loyalty Level: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_loyalty_level"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="loyalty_member_tenant_rule" model="ir.rule">
            <field name="name">Loyalty Member: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_loyalty_member"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- BLOG / CMS - Isolation par tenant         -->
        <!-- ========================================== -->

        <record id="blog_category_tenant_rule" model="ir.rule">
            <field name="name">Blog Category: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_blog_category"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="blog_post_tenant_rule" model="ir.rule">
            <field name="name">Blog Post: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_blog_post"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="blog_tag_tenant_rule" model="ir.rule">
            <field name="name">Blog Tag: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_blog_tag"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="static_page_tenant_rule" model="ir.rule">
            <field name="name">Static Page: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_static_page"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="seo_metadata_tenant_rule" model="ir.rule">
            <field name="name">SEO Metadata: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_seo_metadata"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- MARKETING - Isolation par tenant          -->
        <!-- ========================================== -->

        <record id="marketing_campaign_tenant_rule" model="ir.rule">
            <field name="name">Marketing Campaign: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_marketing_campaign"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="email_template_tenant_rule" model="ir.rule">
            <field name="name">Email Template: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_email_template"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="marketing_popup_tenant_rule" model="ir.rule">
            <field name="name">Marketing Popup: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_marketing_popup"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="contact_list_tenant_rule" model="ir.rule">
            <field name="name">Contact List: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_contact_list"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- SUPPORT / TICKETS - Isolation par tenant  -->
        <!-- ========================================== -->

        <record id="ticket_tenant_rule" model="ir.rule">
            <field name="name">Ticket: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_ticket"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- STOCK - Isolation par tenant              -->
        <!-- ========================================== -->

        <record id="cycle_count_tenant_rule" model="ir.rule">
            <field name="name">Cycle Count: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_cycle_count"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- THEME / UI - Isolation par tenant         -->
        <!-- ========================================== -->

        <record id="theme_preset_tenant_rule" model="ir.rule">
            <field name="name">Theme Preset: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_theme_preset"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="hero_slide_tenant_rule" model="ir.rule">
            <field name="name">Hero Slide: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_hero_slide"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="promo_banner_tenant_rule" model="ir.rule">
            <field name="name">Promo Banner: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_promo_banner"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="promo_message_tenant_rule" model="ir.rule">
            <field name="name">Promo Message: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_promo_message"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="trust_badge_tenant_rule" model="ir.rule">
            <field name="name">Trust Badge: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_trust_badge"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="menu_tenant_rule" model="ir.rule">
            <field name="name">Menu: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_menu"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- SETTINGS - Isolation par tenant           -->
        <!-- ========================================== -->

        <record id="email_config_tenant_rule" model="ir.rule">
            <field name="name">Email Config: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_email_config"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="api_settings_tenant_rule" model="ir.rule">
            <field name="name">API Settings: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_api_settings"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- POS - Isolation par tenant                -->
        <!-- ========================================== -->

        <record id="pos_config_tenant_rule" model="ir.rule">
            <field name="name">POS Config: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_pos_config"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <record id="pos_session_tenant_rule" model="ir.rule">
            <field name="name">POS Session: multi-tenant</field>
            <field name="model_id" ref="model_quelyos_pos_session"/>
            <field name="domain_force">['|', ('tenant_id', '=', False), ('tenant_id', '=', user.tenant_id.id)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- SUPER ADMIN - Full Access                 -->
        <!-- ========================================== -->

        <!-- Backups : Accès super admin uniquement -->
        <record id="backup_superadmin_rule" model="ir.rule">
            <field name="name">Backup: super admin only</field>
            <field name="model_id" ref="model_quelyos_backup"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        </record>

        <!-- CORS : Accès super admin uniquement -->
        <record id="cors_entry_superadmin_rule" model="ir.rule">
            <field name="name">CORS Entry: super admin only</field>
            <field name="model_id" ref="model_quelyos_cors_entry"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        </record>

        <!-- Provisioning Jobs : Accès super admin uniquement -->
        <record id="provisioning_job_superadmin_rule" model="ir.rule">
            <field name="name">Provisioning Job: super admin only</field>
            <field name="model_id" ref="model_quelyos_provisioning_job"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        </record>

    </data>
</odoo>
