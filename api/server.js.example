// File: apps/api/server.js (updated snippet)
// Mount API versioning

const express = require('express');
const app = express();

// ... existing middleware ...

// ============ API Routes ============

// Health check (not versioned)
app.get('/health', (req, res) => {
  res.json({ status: 'ok', timestamp: new Date().toISOString() });
});

// API v1
const apiV1 = require('./src/routes/v1');
app.use('/api/v1', apiV1);

// Legacy routes (for backward compatibility, will be deprecated)
// Redirect old routes to v1
const legacyRoutes = require('./src/routes');
app.use('/', legacyRoutes); // Keep old routes working but log deprecation

// 404 handler
app.use((req, res) => {
  res.status(404).json({ 
    error: 'Not Found',
    message: 'Endpoint not found. Please check API documentation at /docs',
    available_versions: ['v1'],
  });
});

module.exports = app;
