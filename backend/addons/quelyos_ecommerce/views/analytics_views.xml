<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Vue formulaire analytics avec KPIs -->
        <record id="view_ecommerce_analytics_form" model="ir.ui.view">
            <field name="name">ecommerce.analytics.form</field>
            <field name="model">ecommerce.analytics</field>
            <field name="arch" type="xml">
                <form string="Analytics E-commerce">
                    <sheet>
                        <div class="oe_title">
                            <h1>Tableau de Bord E-commerce</h1>
                        </div>

                        <!-- Filtres période -->
                        <group>
                            <group>
                                <field name="date_from"/>
                            </group>
                            <group>
                                <field name="date_to"/>
                            </group>
                        </group>

                        <notebook>
                            <!-- Onglet Vue d'ensemble -->
                            <page string="Vue d'ensemble" name="overview">
                                <group>
                                    <group string="Ventes">
                                        <field name="total_orders" widget="statinfo"/>
                                        <field name="total_revenue" widget="monetary"/>
                                        <field name="average_order_value" widget="monetary"/>
                                        <field name="conversion_rate" widget="percentage"/>
                                        <field name="total_products_sold"/>
                                    </group>
                                    <group string="Paniers">
                                        <field name="active_carts" widget="statinfo"/>
                                        <field name="abandoned_carts" widget="statinfo"/>
                                        <field name="abandoned_cart_value" widget="monetary"/>
                                        <button name="action_view_abandoned_carts"
                                                string="Voir Paniers Abandonnés"
                                                type="object"
                                                class="oe_highlight"
                                                icon="fa-shopping-cart"/>
                                    </group>
                                </group>
                                <group>
                                    <group string="Clients">
                                        <field name="total_customers"/>
                                        <field name="new_customers" widget="statinfo"/>
                                        <field name="returning_customers"/>
                                    </group>
                                    <group string="Wishlist">
                                        <field name="total_wishlist_items"/>
                                        <field name="wishlist_conversion" widget="percentage"/>
                                    </group>
                                </group>
                            </page>

                            <!-- Onglet Produits -->
                            <page string="Top Produits" name="products">
                                <button name="action_view_top_products"
                                        string="Voir Tous les Top Produits"
                                        type="object"
                                        class="oe_highlight mb-3"
                                        icon="fa-trophy"/>
                                <separator string="Les 10 Produits les Plus Vendus"/>
                                <group>
                                    <field name="top_products_count" invisible="1"/>
                                </group>
                            </page>

                            <!-- Onglet Catégories -->
                            <page string="Catégories" name="categories">
                                <separator string="Performance par Catégorie"/>
                                <p class="text-muted">
                                    Utilisez les graphiques ci-dessous pour analyser les ventes par catégorie.
                                </p>
                            </page>
                        </notebook>

                        <field name="currency_id" invisible="1"/>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Action analytics -->
        <record id="action_ecommerce_analytics" model="ir.actions.act_window">
            <field name="name">Analytics E-commerce</field>
            <field name="res_model">ecommerce.analytics</field>
            <field name="view_mode">form</field>
            <field name="target">current</field>
            <field name="context">{'form_view_initial_mode': 'edit'}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Tableau de bord Analytics E-commerce
                </p>
                <p>
                    Visualisez les métriques clés de votre boutique en ligne :
                    ventes, conversions, paniers abandonnés, top produits.
                </p>
            </field>
        </record>

        <!-- Menu Analytics - Moved to menu.xml -->

        <!-- Vue graph des ventes par produit -->
        <record id="view_sale_report_product_graph" model="ir.ui.view">
            <field name="name">sale.report.product.graph</field>
            <field name="model">sale.report</field>
            <field name="arch" type="xml">
                <graph string="Ventes par Produit" type="bar">
                    <field name="product_tmpl_id"/>
                    <field name="product_uom_qty" type="measure"/>
                    <field name="price_total" type="measure"/>
                </graph>
            </field>
        </record>

        <!-- Vue pivot des ventes -->
        <record id="view_sale_report_pivot" model="ir.ui.view">
            <field name="name">sale.report.pivot</field>
            <field name="model">sale.report</field>
            <field name="arch" type="xml">
                <pivot string="Analyse des Ventes">
                    <field name="date" interval="month" type="row"/>
                    <field name="categ_id" type="row"/>
                    <field name="product_uom_qty" type="measure"/>
                    <field name="price_total" type="measure"/>
                </pivot>
            </field>
        </record>

        <!-- Action rapport ventes (utilise sale.report natif) -->
        <record id="action_ecommerce_sales_report" model="ir.actions.act_window">
            <field name="name">Rapport Ventes E-commerce</field>
            <field name="res_model">sale.report</field>
            <field name="view_mode">graph,pivot,list</field>
            <field name="context">{
                'search_default_year': 1,
                'group_by': []
            }</field>
            <field name="domain">[]</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Aucune donnée de vente
                </p>
                <p>
                    Analysez vos ventes e-commerce avec des graphiques et tableaux croisés dynamiques.
                </p>
            </field>
        </record>

        <!-- Sous-menu Rapports - Moved to menu.xml -->

    </data>
</odoo>
